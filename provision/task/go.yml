version: '3'

env:
  GO_FILES:
    sh: find ./ -type f -name '*.go' | grep -v '/vendor/' | sort -u

tasks:

  check:
    desc: exist go and dependences
    run: once
    status:
      - command -v go
      - command -v gofmt
      - command -v golangci-lint
      - command -v goreleaser

  setup:
    desc: Setup go dependences.
    run: once
    cmds:
      - go mod download
      - go mod tidy
      - go mod vendor
      - go generate -v ./...

  fmt:
    desc: Setup go dependences.
    run: once
    cmds:
      - gofmt -s -l -w $(GO_FILES)

  lint:
    desc: Run linter go.
    run: once
    cmds:
      - golangci-lint run --config .github/linters/.golangci.yml

  fix:
    desc: Fix lint violations.
    run: once
    cmds:
      - golangci-lint run --fix --config .github/linters/.golangci.yml

  vet:
    desc: Run go vet against code.
    run: once
    cmds:
      - go vet ./ ...

  build:
    desc: Build go packages.
    run: once
    cmds:
      - goreleaser build --snapshot --rm-dist
